{% extends "tickets/base.html" %}

{% block title %}Tickets · ServiceDesk{% endblock %}

{% block topbar_actions %}
  <a class="btn primary" href="/tickets/new/">+ New ticket</a>
{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-header">
      <h2>Tickets</h2>
      <div class="sub">
        {% if tickets %}
          {{ tickets|length }} ticket{{ tickets|length|pluralize }}
        {% else %}
          No tickets yet
        {% endif %}
      </div>
    </div>

    <div class="card-body">
      {% if tickets %}
        <ul class="list">
          {% for ticket in tickets %}
            <li>
              <a class="row" href="/tickets/{{ ticket.id }}/">
                <div class="row-left">
                  <div class="row-title">#{{ ticket.id }} — {{ ticket.title }}</div>
                  <div class="row-meta">
                    Created {{ ticket.created_at|date:"j M Y, H:i" }}
                  </div>
                </div>
                
                <form method="get" style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px;">
                  <input type="text" name="q" placeholder="Search tickets..." value="{{ q }}" style="max-width:340px;" />
                  <select name="status" style="max-width:220px;">
                    <option value="">All statuses</option>
                    {% for value, label in status_choices %}
                      <option value="{{ value }}" {% if status == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                  </select>
                  <button class="btn" type="submit">Filter</button>
                  <a class="btn" href="/tickets/">Reset</a>
                </form>

                <div class="badges">
                  <span class="badge info">{{ ticket.get_status_display }}</span>

                  {% if ticket.get_priority_display == "URGENT" or ticket.get_priority_display == "HIGH" %}
                    <span class="badge bad">{{ ticket.get_priority_display }}</span>
                  {% elif ticket.get_priority_display == "MEDIUM" %}
                    <span class="badge warn">{{ ticket.get_priority_display }}</span>
                  {% else %}
                    <span class="badge good">{{ ticket.get_priority_display }}</span>
                  {% endif %}
                </div>
              </a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="small">Create your first ticket to get started.</p>
        <div class="actions">
          <a class="btn primary" href="/tickets/new/">+ New ticket</a>
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}